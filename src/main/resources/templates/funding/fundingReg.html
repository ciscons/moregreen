<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" class="no-js" lang="zxx">
 <style>
 
    #container {
        width: 1000px;
        margin: 20px auto;
    }
    .ck-editor__editable[role="textbox"] {
        /* editing area */
        min-height: 200px;
    }
    .ck-content .image {
        /* block images */
        max-width: 80%;
        margin: 20px auto;
    }
    
</style>

<th:block
	th:replace="~{./include/mainLayout :: setContent( ~{:: #wrap}  ) }">
	<body>
		<section id="wrap">
			<section class="items-grid section custom-padding">
				<div class="container">
					<div class="row">
						<div class="col-12">
							<div class="section-title">
								<h2 class="wow fadeInUp" data-wow-delay=".4s">프로젝트 개설 신청</h2>
								<p class="wow fadeInUp" data-wow-delay=".6s">아래의 항목을 작성해주시기 바랍니다.</p>
							</div>
						</div>
					</div>
					<form name="fundingForm" id="fundingForm" action="fundingForm" method="post" enctype="multipart/form-data">
						<input type="hidden" name="m_num" th:value="${session.member.m_num}">
						<div class="container">
							<div class="input-group mb-3">
								<span class="input-group-text" >프로젝트 명칭</span>
								<input id="f_title" type="text" class="form-control" name="f_title" th:value="${dto != null ? dto.f_title : '' }" placeholder="프로젝트 명칭 작성">
							</div>
							<span id="titleCheckMsg"></span>
							<div class="input-group mb-3">
								<span class="input-group-text" >상호명</span>
								<input id="f_bname" type="text" class="form-control" name="f_bname" th:value="${dto != null ? dto.f_bname : '' }" placeholder="상호명 작성">
							</div>
							<span id="bnameCheckMsg"></span>
							<div class="input-group mb-3">
								<span class="input-group-text">프로젝트 내용</span>
								<!-- <textarea class="form-control" placeholder="내용 작성" name="f_content" th:value="${dto != null ? dto.f_content : '' }"></textarea> -->
								<div id="container">
						            <textarea name="f_content" id="editor" class="f_content">
						            </textarea>
						        </div>
						        <span id="contentCheckMsg"></span>
							</div>
							<div class="input-group mb-3">
								<span class="input-group-text">목표 금액</span>
								<div class="form-control">500,000원</div>
							</div>
							<div class="input-group mb-3">
								<span class="input-group-text" id="basic-addon1">리워드 명칭</span> 
								<input id="f_reward" type="text" class="form-control" placeholder="리워드명 작성" name="f_reward" th:value="${dto != null ? dto.f_reward : '' }">
							</div>
							<span id="rewardCheckMsg"></span>
							<div class="input-group mb-3">
								<span class="input-group-text">리워드 금액</span> 
								<input id="f_price" type="text" class="form-control" placeholder="예) 10000" name="f_price" th:value="${dto != null ? dto.f_price : '' }">
								<span class="input-group-text">원</span>
							</div>
							<span id="priceCheckMsg"></span>
							<div class="input-group mb-3">
								<label class="input-group-text" for="inputGroupFile02">대표 사진</label> 
								<input type="file" class="form-control" id="mainFile1" name="mainFile">
								<input type="file" class="form-control" id="mainFile2" name="mainFile">
								<input type="file" class="form-control" id="mainFile3" name="mainFile">
							</div>
							<span id="mainFileCheckMsg"></span>
							<div class="input-group mb-3">
								<label class="input-group-text" for="inputGroupFile03">내용 사진</label> 
								<input type="file" class="form-control" id="contentFile1" name="contentFile">
								<input type="file" class="form-control" id="contentFile2" name="contentFile">
								<input type="file" class="form-control" id="contentFile3" name="contentFile">
							</div> 
							<span id="contentFileCheckMsg"></span>
							<div class="input-group mb-3">
								<span class="input-group-text" id="basic-addon1">사업자 등록번호</span>
								<input type="text" maxlength="10" class="form-control" id="bizno" placeholder="사업자 등록번호 작성" name="f_bnum" th:value="${dto != null ? dto.f_bnum : '' }">
							</div>
							<span id="bNumCheckMsg"></span>
							<div class="input-group mb-3">
								<label class="input-group-text" for="inputGroupFile01">사업자 등록증</label>
								<input type="file" class="form-control" id="bFile" name="file" accept=".jpg, .png">
							</div>
							<span id="bFileCheckMsg"></span>
							<div class="input-group mb-3">
								<label class="input-group-text" for="inputGroupSelect01">프로젝트 기간(일)</label> 
								<select class="form-select" name="f_days" th:value="${dto != null ? dto.f_days : '' }">
									<option value=30>30</option>
									<option value=60>60</option>
									<option value=90>90</option>
								</select>	
							</div>
						</div>
						<div class="mb-3" align="right">
							<button class="btn btn-primary" type="button" >
							<div class="save">신청하기</div></button>
						</div>
					</form>
				</div>
			</section>
		</section>
	</body>
</th:block>
<script src="https://cdn.ckeditor.com/ckeditor5/35.1.0/super-build/ckeditor.js"></script>
  
<script>

$(document).on("keyup", "#bizno", function() { 
	$(this).val( $(this).val().replace(/[^0-9]/g, "").replace(/([0-9]{3})([0-9]{2})([0-9]{5})$/,"$1-$2-$3").replace("--", "-") );
});

$("#fundingForm").on("blur", "input",  function(){
	if($(this).val().trim().length != 0){
		$(this).closest("div").next("span").html("");
	}
});


$(".save").on("click", function() {
	
	event.preventDefault();
	
	//프로젝트 명칭 유효섬 검사
	if($("#f_title").val().trim().length == 0){  
	 titleCheckMsg.style.color="red";
	 titleCheckMsg.innerHTML="프로젝트 명칭을 입력하세요";
	 document.getElementById('f_title').focus();
	 return false;
	} 
	
	//상호명 유효섬 검사
	if($("#f_bname").val().trim().length == 0){      
	 bnameCheckMsg.style.color="red";
	 bnameCheckMsg.innerHTML="상호명을 입력하세요";
	 document.getElementById('f_bname').focus();
	 return false;
	}
	
	
	//프로젝트 내용 유효섬 검사
	if(editor.getData().trim().length == 0){
	 contentCheckMsg.style.color="red";
	 contentCheckMsg.innerHTML="내용을 입력하세요";
	 return false;
	}  else{
		$("#contentCheckMsg").html("");
	}	
	
	
	//리워드 명칭 유효섬 검사
	if($("#f_reward").val().trim().length == 0){   
	 rewardCheckMsg.style.color="red";
	 rewardCheckMsg.innerHTML="리워드 명칭을 입력하세요";
	 document.getElementById('f_reward').focus();
	 return false;
	}
	
	
	//리워드 금액 유효섬 검사
	if($("#f_price").val().trim().length == 0){      
	 priceCheckMsg.style.color="red";
	 priceCheckMsg.innerHTML="리워드 금액을 입력하세요";
	 document.getElementById('f_price').focus();
	 return false;
	} 
	
	
	//대표사진 유효성 검사
	if($("#mainFile1").val().trim().length == 0){
	 mainFileCheckMsg.style.color="red";
	 mainFileCheckMsg.innerHTML="대표 사진 3장 모두 등록해주세요";
	 return false;
	} else if($("#mainFile1").val().trim().length != 0){
		 var ext = $('#mainFile1').val().split('.').pop().toLowerCase();
	      if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
	  	 alert('gif,png,jpg,jpeg 파일만 업로드 할수 있습니다.');
	  	 return false;
	     }
	}
	
	if($("#mainFile2").val().trim().length == 0){
	 mainFileCheckMsg.style.color="red";
	 mainFileCheckMsg.innerHTML="대표 사진 3장 모두 등록해주세요";
	 return false;
	} else if($("#mainFile2").val().trim().length != 0){
		 var ext = $('#mainFile2').val().split('.').pop().toLowerCase();
	      if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
	  	 alert('gif,png,jpg,jpeg 파일만 업로드 할수 있습니다.');
	  	 return false;
	     }
	}
	
	if($("#mainFile3").val().trim().length == 0){
	 mainFileCheckMsg.style.color="red";
	 mainFileCheckMsg.innerHTML="대표 사진 3장 모두 등록해주세요";
	 return false;
	} else if($("#mainFile3").val().trim().length != 0){
		 var ext = $('#mainFile3').val().split('.').pop().toLowerCase();
	      if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
	  	 alert('gif,png,jpg,jpeg 파일만 업로드 할수 있습니다.');
	  	 return false;
	     }
	}
	
	
	//내용사진 유효성 검사
	if($("#contentFile1").val().trim().length == 0){
	 contentFileCheckMsg.style.color="red";
	 contentFileCheckMsg.innerHTML="내용에 들어갈 사진을 3장 모두 등록해주세요";
	 return false;
	} else if($("#contentFile1").val().trim().length != 0){
		 var ext = $('#contentFile1').val().split('.').pop().toLowerCase();
	      if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
	  	 alert('gif,png,jpg,jpeg 파일만 업로드 할수 있습니다.');
	  	 return false;
	     }
	}
	
	if($("#contentFile2").val().trim().length == 0){
	 contentFileCheckMsg.style.color="red";
	 contentFileCheckMsg.innerHTML="내용에 들어갈 사진을 3장 모두 등록해주세요";
	 return false;
	} else if($("#contentFile2").val().trim().length != 0){
		 var ext = $('#contentFile2').val().split('.').pop().toLowerCase();
	      if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
	  	 alert('gif,png,jpg,jpeg 파일만 업로드 할수 있습니다.');
	  	 return false;
	     }
	}
	
	if($("#contentFile3").val().trim().length == 0){
	 contentFileCheckMsg.style.color="red";
	 contentFileCheckMsg.innerHTML="내용에 들어갈 사진을 3장 모두 등록해주세요";
	 return false;
	} else if($("#contentFile3").val().trim().length != 0){
		 var ext = $('#contentFile3').val().split('.').pop().toLowerCase();
	      if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
	  	 alert('gif,png,jpg,jpeg 파일만 업로드 할수 있습니다.');
	  	 return false;
	     }
	}
	
	//사업자 번호 유효성 검사
	var pBizno = $("#bizno").val();	//사업자번호
	console.log(pBizno);
	
	if(!pBizno){
	 bNumCheckMsg.style.color="red";
	 bNumCheckMsg.innerHTML="사업자 번호를 입력해주세요";
	 $("#bizno").focus();
	 return false;
	 
	} else if(pBizno.replaceAll("-","").length != 10 ){
	 bNumCheckMsg.style.color="red";
	 bNumCheckMsg.innerHTML="사업자 번호는 하이픈(-)을 포함한 12자리입니다.";
	 $("#bizno").focus();
	 return false;
	 
	} else if(!checkCorporateRegistrationNumber(pBizno.replaceAll("-",""))){
	 bNumCheckMsg.style.color="red";
	 bNumCheckMsg.innerHTML="올바른 사업자 번호를 입력해주세요";
	 $("#bizno").focus();
	 return false;
	}
	
	if($("#bFile").val().trim().length == 0){
	 bFileCheckMsg.style.color="red";
	 bFileCheckMsg.innerHTML="사업자 등록증을 첨부해주세요";
	 return false;
	} else if($("#bFile").val().trim().length != 0){
		 var ext = $('#bFile').val().split('.').pop().toLowerCase();
	      if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
	  	 alert('gif,png,jpg,jpeg 파일만 업로드 할수 있습니다.');
	  	 return false;
	     }
	} 
	
    $("#fundingForm").submit();
});

//사업자 번호 유효성 검증 테스트
function checkCorporateRegistrationNumber(value) {
    var valueMap = value.replace(/-/gi, '').split('').map(function(item) {
        return parseInt(item, 10);
    });

    if (valueMap.length === 10) {
        var multiply = new Array(1, 3, 7, 1, 3, 7, 1, 3, 5);
        var checkSum = 0;

        for (var i = 0; i < multiply.length; ++i) {
            checkSum += multiply[i] * valueMap[i];
        }

        checkSum += parseInt((multiply[8] * valueMap[8]) / 10, 10);
        return Math.floor(valueMap[9]) === (10 - (checkSum % 10));
    }

    return false;
}
	
let editor;
 // This sample still does not showcase all CKEditor 5 features (!)
 // Visit https://ckeditor.com/docs/ckeditor5/latest/features/index.html to browse all the features.
 CKEDITOR.ClassicEditor.create(document.getElementById("editor"), {
     // https://ckeditor.com/docs/ckeditor5/latest/features/toolbar/toolbar.html#extended-toolbar-configuration-format
     toolbar: {
         items: [
             'exportPDF','exportWord', '|',
             'findAndReplace', 'selectAll', '|',
             'heading', '|',
             'bold', 'italic', 'strikethrough', 'underline', '|',
             'numberedList', 'todoList', '|',
             'outdent', 'indent', '|',
             'undo', 'redo',
             '-',
             'fontSize', 'fontFamily', 'fontColor', 'fontBackgroundColor', 'highlight', '|',
             'alignment', '|',
             'link', 'insertImage', 'blockQuote', 'mediaEmbed', '|',
             'specialCharacters', 'horizontalLine', 'pageBreak', '|',
             'textPartLanguage', '|',
             'sourceEditing'
         ],
         shouldNotGroupWhenFull: true
     },
     // Changing the language of the interface requires loading the language file using the <script> tag.
     language: 'ko',
     
     list: {
         properties: {
             styles: true,
             startIndex: true,
             reversed: true
         }
     },
     // https://ckeditor.com/docs/ckeditor5/latest/features/headings.html#configuration
     heading: {
         options: [
             { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
             { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },
             { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },
             { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' },
             { model: 'heading4', view: 'h4', title: 'Heading 4', class: 'ck-heading_heading4' },
             { model: 'heading5', view: 'h5', title: 'Heading 5', class: 'ck-heading_heading5' },
             { model: 'heading6', view: 'h6', title: 'Heading 6', class: 'ck-heading_heading6' }
         ]
     },
     // https://ckeditor.com/docs/ckeditor5/latest/features/editor-placeholder.html#using-the-editor-configuration
     placeholder: '내용을 입력하세요',
     // https://ckeditor.com/docs/ckeditor5/latest/features/font.html#configuring-the-font-family-feature
     fontFamily: {
         options: [
             'default',
             'Arial, Helvetica, sans-serif',
             'Courier New, Courier, monospace',
             'Georgia, serif',
             'Lucida Sans Unicode, Lucida Grande, sans-serif',
             'Tahoma, Geneva, sans-serif',
             'Times New Roman, Times, serif',
             'Trebuchet MS, Helvetica, sans-serif',
             'Verdana, Geneva, sans-serif',
             '궁서체',
     		 '바탕',
     		 '돋움'
         ],
         supportAllValues: true
     },
     // https://ckeditor.com/docs/ckeditor5/latest/features/font.html#configuring-the-font-size-feature
     fontSize: {
         options: [ 10, 12, 14, 'default', 18, 20, 22 ],
         supportAllValues: true
     },
     // Be careful with the setting below. It instructs CKEditor to accept ALL HTML markup.
     // https://ckeditor.com/docs/ckeditor5/latest/features/general-html-support.html#enabling-all-html-features
     htmlSupport: {
         allow: [
             {
                 name: /.*/,
                 attributes: true,
                 classes: true,
                 styles: true
             }
         ]
     },
     // Be careful with enabling previews
     // https://ckeditor.com/docs/ckeditor5/latest/features/html-embed.html#content-previews
     htmlEmbed: {
         showPreviews: true
     },
     // https://ckeditor.com/docs/ckeditor5/latest/features/link.html#custom-link-attributes-decorators
     link: {
         decorators: {
             addTargetToExternalLinks: true,
             defaultProtocol: 'https://',
             toggleDownloadable: {
                 mode: 'manual',
                 label: 'Downloadable',
                 attributes: {
                     download: 'file'
                 }
             }
         }
     },
     // https://ckeditor.com/docs/ckeditor5/latest/features/mentions.html#configuration
     // The "super-build" contains more premium features that require additional configuration, disable them below.
     // Do not turn them on unless you read the documentation and know how to configure them and setup the editor.
     removePlugins: [
         // These two are commercial, but you can try them out without registering to a trial.
         // 'ExportPdf',
         // 'ExportWord',
         'CKBox',
         'CKFinder',
         'EasyImage',
         // This sample uses the Base64UploadAdapter to handle image uploads as it requires no configuration.
         // https://ckeditor.com/docs/ckeditor5/latest/features/images/image-upload/base64-upload-adapter.html
         // Storing images as Base64 is usually a very bad idea.
         // Replace it on production website with other solutions:
         // https://ckeditor.com/docs/ckeditor5/latest/features/images/image-upload/image-upload.html
         // 'Base64UploadAdapter',
         'RealTimeCollaborativeComments',
         'RealTimeCollaborativeTrackChanges',
         'RealTimeCollaborativeRevisionHistory',
         'PresenceList',
         'Comments',
         'TrackChanges',
         'TrackChangesData',
         'RevisionHistory',
         'Pagination',
         'WProofreader',
         // Careful, with the Mathtype plugin CKEditor will not load when loading this sample
         // from a local file system (file://) - load this site via HTTP server if you enable MathType
         'MathType'
     ]
 })
 .then( newEditor => {
    editor = newEditor;
 })
 .catch( error => {
    	    console.error( error );
 });

 

</script>
</html>


